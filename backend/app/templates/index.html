{% extends "base.html" %}

{% block content %}
{{ super() }}
<div class="main-container">
    <div class="row">
      <div class="col-md-11 col-md-offset-1 col-xs-offset-1">
        <h1>Online Schocken</h1>
      </div>
    </div>

    <div class="row">
        <div class="col-md-5 col-md-offset-1 col-xs-offset-1">
          <div class="row">
            <div class="col-md-12">
              <p>Egal ob du <b>Schocken</b>, <b>Jule</b>, <b>MÃ¶rkeln</b>, <b>Knobeln</b>, <b>Maxen</b> oder <b>Meiern</b> willst, hier bist du richtig!</p>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              <h2>Spiel erzeugen</h2>
            </div>
          </div>
          <div class="row">
            <div class="col-xs-11 col-md-8">
              <div class="input-group mb-6">
                <input id="adminname" placeholder="Spielername" type="text" size="20" class="form-control" onkeydown="if(event.key==='Enter')createGame()">
                <div class="input-group-btn">
                  <button class="btn btn-primary btn-outline-secondary" type="button" onclick="createGame()">Erzeugen</button>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              <p>(Link zum Verteilen an die Mitspieler wird generiert)</p>
            </div>
          </div>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
{{ super() }}
<script>

  function createGame(){
    var admin = document.getElementById('adminname');
    var adminname = admin.value;
    var xhttp = new XMLHttpRequest();
    xhttp.open("POST", "/api/game");
    xhttp.setRequestHeader("Content-Type", "application/json");
    xhttp.onreadystatechange = function() {
      if (xhttp.readyState == XMLHttpRequest.DONE) {
        var res=JSON.parse(xhttp.responseText);
        if (xhttp.status != 201){
          alert('Fehler beim erzeugen: '+res.Message);
          location=location;
        }else{
          localStorage.setItem('name', adminname);
          localStorage.setItem('id', res.Admin_Id);
          window.location.href = "/game_waiting/"+res.UUID;
        }
      }
    }
    xhttp.send(JSON.stringify({name:adminname}));
  }

</script>
{% endblock %}
