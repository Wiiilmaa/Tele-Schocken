{% extends "base.html" %}

{% block content %}
{{ super() }}
<div class="page-content">
  <h1>Online Schocken</h1>
  <p>Egal ob du <b>Schocken</b>, <b>Jule</b>, <b>MÃ¶rkeln</b>, <b>Knobeln</b>, <b>Maxen</b> oder <b>Meiern</b> willst, hier bist du richtig!</p>

  <h2>Spiel erzeugen</h2>
  <div class="input-group" style="max-width: 400px;">
    <input id="adminname" placeholder="Spielername" type="text" size="20" class="form-control" onkeydown="if(event.key==='Enter')createGame()" autofocus>
    <div class="input-group-btn">
      <button class="btn btn-primary btn-outline-secondary" type="button" onclick="createGame()">Erzeugen</button>
    </div>
  </div>
  <p>(Link zum Verteilen an die Mitspieler wird generiert)</p>
</div>

{% endblock %}

{% block scripts %}
{{ super() }}
<script>
  (function() {
    var savedName = localStorage.getItem('name');
    if (savedName) {
      var inp = document.getElementById('adminname');
      if (inp) inp.value = savedName;
    }
  })();

  function createGame(){
    var admin = document.getElementById('adminname');
    var adminname = admin.value;
    var xhttp = new XMLHttpRequest();
    xhttp.open("POST", "/api/game");
    xhttp.setRequestHeader("Content-Type", "application/json");
    xhttp.onreadystatechange = function() {
      if (xhttp.readyState == XMLHttpRequest.DONE) {
        var res=JSON.parse(xhttp.responseText);
        if (xhttp.status != 201){
          alert('Fehler beim erzeugen: '+res.Message);
          location=location;
        }else{
          localStorage.setItem('name', adminname);
          localStorage.setItem('id', res.Admin_Id);
          window.location.href = "/game_waiting/"+res.UUID;
        }
      }
    }
    xhttp.send(JSON.stringify({name:adminname}));
  }

</script>
{% endblock %}
